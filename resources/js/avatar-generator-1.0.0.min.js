CP={avatar:{frame:null,proportion:null,image:null,background:null,vertical:null,horizontal:null},upload:{image:null,width:null,height:null},settings:{proportions:["scale","contain","original"],vertical:["top","middle","bottom"],horizontal:["left","center","right"]},generateImage:function(a){console.log(CP);var e=a.getContext("2d"),t=new Image,n=new Image;e.clearRect(0,0,a.width,a.height),e.fillStyle=CP.avatar.background,e.fillRect(0,0,300,300),t.src=CP.upload.image,t.onload=function(){var a=t.height,r=t.width,o=0,i=0;switch(CP.avatar.proportion){case"scale":r>=a?(a=300*a/r,r=300):(r=100*a/r,a=300);break;case"contain":a=300,r=300;break;case"original":}switch(CP.avatar.vertical){case"top":i=0;break;case"middle":i=(300-a)/2;break;case"bottom":i=300-a}switch(CP.avatar.horizontal){case"left":o=0;break;case"center":o=(300-r)/2;break;case"right":o=300-r}e.drawImage(t,o,i,r,a),n.src=CP.avatar.frame,n.onload=function(){e.drawImage(n,0,0,300,300)}}}},$(document).ready(function(){CP.avatar.proportion=$('form input[name="inputImageProportion"]').val(),CP.avatar.frame=$(".frames a.selected img").attr("src"),CP.avatar.background=$("#inputBackgroundColor").val(),CP.avatar.vertical=$('form input[name="inputImagePositionY"]').val(),CP.avatar.horizontal=$('form input[name="inputImagePositionX"]').val(),$("#inputBackgroundColor").parent(".input-group").colorpicker({format:"hex"}).on("changeColor.colorpicker",function(a){if(CP.avatar.background=a.color.toHex(),null!=CP.upload.image){var e=document.getElementById("avatar-canvas");CP.generateImage(e)}}),$(".frames a").click(function(a){if($(".frames a").toggleClass("selected",!1),$(this).toggleClass("selected",!0),CP.avatar.frame=$(this).find("img").attr("src"),null!=CP.upload.image){var e=document.getElementById("avatar-canvas");CP.generateImage(e)}a.preventDefault()}),$('form input[name="inputImageProportion"]').change(function(){var a=$(this).val();if(-1!=CP.settings.proportions.indexOf(a)&&(CP.avatar.proportion=a),null!=CP.upload.image){var e=document.getElementById("avatar-canvas");CP.generateImage(e)}}),$('form input[name="inputImagePositionY"]').change(function(){var a=$(this).val();if(-1!=CP.settings.vertical.indexOf(a)&&(CP.avatar.vertical=a),null!=CP.upload.image){var e=document.getElementById("avatar-canvas");CP.generateImage(e)}}),$('form input[name="inputImagePositionX"]').change(function(){var a=$(this).val();if(-1!=CP.settings.horizontal.indexOf(a)&&(CP.avatar.horizontal=a),null!=CP.upload.image){var e=document.getElementById("avatar-canvas");CP.generateImage(e)}}),$('form input[type="file"]').change(function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(a){var e=new Image;e.src=a.target.result,CP.upload.image=a.target.result,CP.upload.width=e.width,CP.upload.height=e.height;var t=document.getElementById("avatar-canvas");CP.generateImage(t),$("form a").removeAttr("disabled"),$("#avatar-canvas").toggleClass("transparent",!0)},a.readAsDataURL(this.files[0])}}),$("form a").click(function(a){var e=document.getElementById("avatar-canvas");this.href=e.toDataURL()})});